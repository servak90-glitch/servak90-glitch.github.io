# План оптимизации графики и повышения FPS

В ходе анализа были выявлены критические проблемы в компонентах `ScannerCanvas` и `IsometricCanvas`, связанные с неэффективным использованием PixiJS v8. Текущая реализация пересоздает сотни графических объектов каждый кадр (60 раз в секунду), что приводит к высокой нагрузке на процессор и частым срабатываниям сборщика мусора (GC).

## Основные изменения

### 1. Внедрение системы пула объектов (Object Pooling)
- **Цель**: Исключить создание новых `PIXI.Sprite` и `PIXI.Graphics` в каждом кадре.
- **Действие**: Создать менеджер пула, который будет выдавать существующие объекты и возвращать их в резерв при удалении со сцены.

### 2. Использование "Dirty Flags" (Флаги изменений)
- **Цель**: Обновлять свойства объектов (позицию, текст) только при реальном изменении данных.
- **Действие**: Сравнивать текущее состояние стейта с предыдущим перед выполнением тяжелых операций очистки (`removeChildren`) и перерисовки.

### 3. Оптимизация рендеринга текста
- **Цель**: Избежать тяжелой операции генерации текстур из текста в каждом кадре.
- **Действие**: Переход на `BitmapText` или статический пул текстовых объектов с обновлением `.text` только при необходимости.

### 4. Оптимизация караванов (Caravans)
- **Цель**: Снизить нагрузку от отрисовки множества движущихся объектов.
- **Действие**: Использование `ParticleContainer` или `SimpleMesh` для пакетной отрисовки (batching) караванов, если их количество станет значительным (на перспективу).

---

## Предлагаемые изменения по файлам

### [Component] Global Map

#### [MODIFY] [IsometricCanvas.tsx](file:///e:/cosmic-excavator_-void-piercer%20%2823%29/components/GlobalMap/IsometricCanvas.tsx)
- Удаление `removeChildren()` из `app.ticker`.
- Реализация логики синхронизации спрайтов: "создать если нет", "обновить если есть", "скрыть если не нужны".
- Кэширование текстовых меток.

#### [MODIFY] [ScannerCanvas.tsx](file:///e:/cosmic-excavator_-void-piercer%20%2823%29/components/GlobalMap/ScannerCanvas.tsx)
- Оптимизация отрисовки сетки (использование одной текстуры вместо множества линий).
- Устранение пересоздания индикатора игрока.

---

## План проверки

### Автоматизированные тесты
- Проверка отсутствия утечек памяти при многократном открытии/закрытии карты.
- Мониторинг FPS через встроенные инструменты профилирования (DevTools).

### Ручная проверка
- Визуальное подтверждение плавности анимаций на мобильных устройствах (через Capacitor).
- Проверка корректности отображения баз и караванов после оптимизации.
